<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Frontline Terminal</title>
  <script defer data-domain="csfs64.github.io" src="https://plausible.io/js/script.outbound-links.pageview-props.tagged-events.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <script>
    function loadContent(id, path) {
      const container = document.getElementById(id);
      if (container.dataset.loaded === "true") return;

      fetch(path)
        .then(response => response.text())
        .then(html => {
          container.innerHTML = html;
          container.dataset.loaded = "true";

          // è‡ªåŠ¨éšè—é™¤ç¬¬ä¸€æ¡å¤–çš„ thread-item
          const threadContainers = container.querySelectorAll('.thread');
          threadContainers.forEach(thread => {
            const threadItems = thread.querySelectorAll('.thread-item');
            if (threadItems.length > 0) {
              threadItems[0].style.display = 'block';
              threadItems.forEach((item, index) => {
                if (index > 0) item.style.display = 'none';
              });
            }
          });
        })
        .catch(() => {
          container.innerHTML = "<p>âš ï¸ åŠ è½½å¤±è´¥ã€‚</p>";
        });
    }
  </script>
</head>
<body>
  <h1>ğŸ“¡ FRONTLINE TERMINAL</h1>
  <p class="timestamp_lastupdate">æœ€åæ›´æ–°ï¼šåŠ è½½ä¸­...</p>

  <details>
    <summary 
      onclick="loadContent('day-2025-06-04', 'days/2025-06-04.html')" 
      data-title="ğŸï¸ å›½å®¶å®‰å…¨å±€å‘å¸ƒâ€œè››ç½‘â€è¡ŒåŠ¨å®Œæ•´é•œå¤´">
      ğŸ“… 2025-06-04ï¼ˆæ˜ŸæœŸä¸‰ï¼‰
    </summary>
    <div id="day-2025-06-04" data-loaded="false"><p>åŠ è½½ä¸­...</p></div>
  </details>

  <details>
    <summary onclick="loadContent('day-2025-06-03', 'days/2025-06-03.html')">ğŸ“… 2025-06-03ï¼ˆæ˜ŸæœŸäºŒï¼‰</summary>
    <div id="day-2025-06-03" data-loaded="false"><p>åŠ è½½ä¸­...</p></div>
  </details>

  <details>
    <summary onclick="loadContent('day-2025-06-02', 'days/2025-06-02.html')">ğŸ“… 2025-06-02ï¼ˆæš‚æ—¶ä¸è¦ç‚¹ï¼Œä¼šå‡ºbugï¼‰</summary>
    <div id="day-2025-06-02" data-loaded="false"><p>åŠ è½½ä¸­...</p></div>
  </details>

  <hr>
  <p><em>ä½ å¯ä»¥é€šè¿‡åœ¨bilibiliç»™æˆ‘å……ç”µæ¥æ”¯æŒæˆ‘çš„å·¥ä½œ</em></p>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const updateElement = document.querySelector(".timestamp_lastupdate");
      const allDetails = document.querySelectorAll("details");

      if (allDetails.length > 0) {
        const latestDetails = allDetails[0];
        const summary = latestDetails.querySelector("summary");
        const onclick = summary.getAttribute("onclick");
        const match = onclick.match(/loadContent\(['"](.+?)['"]\s*,\s*['"](.+?)['"]\)/);

        if (match) {
          const divId = match[1];
          const htmlPath = match[2];

          fetch(htmlPath)
            .then(response => response.text())
            .then(html => {
              const container = document.getElementById(divId);
              container.innerHTML = html;
              container.dataset.loaded = "true";

              // éšè—é™¤ç¬¬ä¸€æ¡ thread-item
              const threadContainers = container.querySelectorAll('.thread');
              threadContainers.forEach(thread => {
                const threadItems = thread.querySelectorAll('.thread-item');
                if (threadItems.length > 0) {
                  threadItems[0].style.display = 'block';
                  threadItems.forEach((item, index) => {
                    if (index > 0) item.style.display = 'none';
                  });
                }
              });

              // æå–æ—¥æœŸ
              const dateMatch = summary.textContent.match(/\d{4}-\d{2}-\d{2}/);
              const latestDate = dateMatch ? dateMatch[0] : "æœªçŸ¥æ—¥æœŸ";

              // æå–æ ‡é¢˜ï¼ˆå»æ‰æ—¥æœŸä¸æ˜ŸæœŸï¼‰
              const rawText = summary.textContent.trim();
              let title = rawText.replace(/^ğŸ“…\s*\d{4}-\d{2}-\d{2}ï¼ˆ.*?ï¼‰\s*/, '').trim();
              if (!title) title = '[æ— æ ‡é¢˜]';

              // è™šæ‹Ÿ DOM æå–æœ€å thread-item çš„å‰6å­—
              const tempDiv = document.createElement("div");
              tempDiv.innerHTML = html;
              const threadItems = tempDiv.querySelectorAll(".thread-item");

              let previewText = "";
              if (threadItems.length > 0) {
                const lastThread = threadItems[threadItems.length - 1];
                const p = lastThread.querySelector("p");
                if (p) previewText = p.textContent.trim().slice(0, 6);
              }

              updateElement.textContent = `æœ€åæ›´æ–°ï¼š${latestDate} ${title} ${previewText}...`;
            })
            .catch(() => {
              updateElement.textContent = "æœ€åæ›´æ–°ï¼šâš ï¸ è·å–å¤±è´¥";
            });
        }
      }
    });

    function expandThread(button) {
      const thread = button.closest('details');
      const threadItems = thread.querySelectorAll('.thread-item');
      if (thread.classList.contains('expanded')) {
        thread.classList.remove('expanded');
        button.textContent = "ğŸ“– å±•å¼€å…¨éƒ¨";
        threadItems.forEach((item, index) => {
          if (index !== 0) item.style.display = 'none';
        });
      } else {
        thread.classList.add('expanded');
        button.textContent = "ğŸ“š æ”¶èµ·";
        threadItems.forEach(item => item.style.display = 'block');
      }
    }
  </script>

  <!-- å›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡† -->
  <div id="image-modal" class="modal" onclick="closeModal()">
    <img id="modal-image" class="modal-image" src="">
  </div>

  <script>
    document.addEventListener('click', function (e) {
      if (e.target.classList.contains('separator-image')) {
        const modal = document.getElementById('image-modal');
        const modalImg = document.getElementById('modal-image');
        modal.style.display = 'flex';
        modalImg.src = e.target.src;
      }
    });

    function closeModal() {
      document.getElementById('image-modal').style.display = 'none';
    }

    document.addEventListener('keydown', function (e) {
      if (e.key === "Escape") {
        closeModal();
      }
    });
  </script>

  <script>
    document.addEventListener("dblclick", e => e.preventDefault());
    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("keydown", e => {
      if (e.key === "F12" || (e.ctrlKey && e.shiftKey && e.key === "I")) {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
