<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Frontline Terminal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ğŸ“¡ FRONTLINE TERMINAL</h1>
  <p class="timestamp_lastupdate">æœ€åæ›´æ–°ï¼š2025-06-04</p>

  <!-- æ›´æ–°æ—¥å¿—åŒºåŸŸ -->
  <details id="update-log" class="update-log" open>
    <summary id="latest-update-summary">ğŸ“¢ æœ€æ–°æ›´æ–°ï¼šåŠ è½½ä¸­...</summary>
  </details>

  <!-- æ¯æ—¥æ›´æ–°åŒºåŸŸ -->
  <details>
    <summary onclick="loadContent('day-2025-06-04', 'days/2025-06-04.html')">ğŸ“… 2025-06-04ï¼ˆæ˜ŸæœŸä¸‰ï¼‰</summary>
    <div id="day-2025-06-04" data-loaded="false">
      <p>åŠ è½½ä¸­...</p>
    </div>
  </details>

  <details>
    <summary onclick="loadContent('day-2025-06-03', 'days/2025-06-03.html')">ğŸ“… 2025-06-03ï¼ˆæ˜ŸæœŸäºŒï¼‰</summary>
    <div id="day-2025-06-03" data-loaded="false">
      <p>åŠ è½½ä¸­...</p>
    </div>
  </details>

  <script>
    function loadContent(id, path, callback) {
      const container = document.getElementById(id);
      if (container.dataset.loaded === "true") {
        if (callback) callback();
        return;
      }

      fetch(path)
        .then(response => response.text())
        .then(html => {
          container.innerHTML = html;
          container.dataset.loaded = "true";

          const summary = container.querySelector('summary');
          const threadItems = container.querySelectorAll('.thread .thread-item');
          const lastItem = threadItems[threadItems.length - 1];
          if (summary && lastItem) {
            const summaryId = `event-${id}-0`;
            summary.id = summaryId;
            if (!lastItem.id) lastItem.id = `${summaryId}-latest-thread`;
            const preview = (lastItem.textContent || '').trim().slice(0, 6);
            const latestLink = `<a href="#" onclick="expandAndScroll('${id}', '${summaryId}', '${lastItem.id}')">ğŸ“¢ æœ€æ–°æ›´æ–°ï¼š${summary.textContent.trim()}ï¼š${preview}...</a>`;
            document.getElementById('latest-update-summary').innerHTML = latestLink;
          }

          if (callback) callback();
        })
        .catch(() => {
          container.innerHTML = "<p>âš ï¸ åŠ è½½å¤±è´¥ã€‚</p>";
        });
    }

    function expandAndScroll(dayId, summaryId, threadId) {
      const dayDetails = document.getElementById(dayId).closest('details');
      dayDetails.open = true;

      loadContent(dayId, `days/${dayId.replace('day-', '')}.html`, () => {
        const summary = document.getElementById(summaryId);
        if (summary) {
          summary.click();
          setTimeout(() => {
            const expandBtn = summary.parentElement.querySelector('.expand-thread');
            if (expandBtn) expandBtn.click();
            if (threadId) {
              const target = document.getElementById(threadId);
              if (target) target.scrollIntoView({ behavior: 'smooth' });
            }
          }, 300);
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadContent("day-2025-06-04", "days/2025-06-04.html");
    });
  </script>
</body>
</html>
